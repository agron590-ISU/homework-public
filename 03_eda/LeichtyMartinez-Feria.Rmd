---
title: 'HW3: Elektra vs. Catwoman, a.k.a. Gender in Comics'
author: "Sarah Leichty and Rafael Martinez-Feria"
date: "October 14, 2016"
output:
  pdf_document: default
  html_document: default
---

## Possible sexist tendencies in comics? Really?

Write here some sort of introduction

```{r datasetup, echo=F, message=F,warning=FALSE}
require(dplyr)
require(ggplot2)
require(reshape2)

# Read data sets
dc <- read.csv("data/dc-wikia-data.csv", na.strings = "")
marv <- read.csv("data/marvel-wikia-data.csv", na.strings = "")

#Check if names are the same
#names(dc) == names(marv) # not the same names

#Match names with lower case
names(dc) <- tolower(names(dc))
names(marv) <- tolower(names(marv))

#all(names(dc) == names(marv)) # now they are all the same!

# Add publisher inf
dc$publisher <- "DC"
marv$publisher <- "Marvel"

# Merge datasets
comics <- rbind(dc,marv)

remove(dc,marv)
```

```{r cleandata,echo=F, message=F,warning=FALSE}
### Clean data
comics$align <- gsub(" Characters", "", comics$align)
comics$sex <- gsub(" Characters", "", comics$sex)
comics$alive <- gsub(" Characters", "", comics$alive)
comics$gsm <- gsub(" Characters", "", comics$gsm)
comics$eye <- gsub(" Eyes", "", comics$eye)
comics$hair <- gsub(" Hair", "", comics$hair)

# month of first appreance
comics$month <-gsub("[^[:alpha:]]","",comics$first.appearance)
comics$month <- substr(comics$month,start=1,stop=3)

comics$month <- match(comics$month,month.abb)

```

```{r mythemes, echo=F, message=F,warning=FALSE}

mytheme <- theme_linedraw()
myfillscale <- scale_fill_manual(values = c("#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"))
mycolorscale <- scale_colour_manual(values = c("#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"))

```

#### Is there any pattern around gender in the characters of comics?

```{r}
## figure of total number of characters male vs female

apperances <- 
  comics %>%
  group_by(sex, align,publisher) %>%
  summarise(ave_app = mean(appearances,na.rm=T),
            total_app = sum(appearances,na.rm=T),
            char = length(appearances))

#ggplot(data=apperances[apperances$sex %in% c("Female","Male"),], aes(x=align, y=char,fill=sex))+
#  geom_bar(stat = "identity",position = "dodge",colour="black") + 
#  labs(x="Charater type", y="Number of characters", fill="Gender") + 
#  mytheme + myfillscale

ggplot(data=apperances[apperances$sex %in% c("Female","Male"),],
       aes(x=align))+
  geom_bar(aes(y=ave_app,fill=sex),stat = "identity",position = "dodge",colour="black") + 
  facet_grid(publisher~.) +
  geom_text(aes(y=ave_app+3, group=sex, label = paste0("n=",char)), position = position_dodge(0.9)) + 
  labs(x="Charater type", y="Average apperances", fill="Gender") + 
  mytheme + myfillscale
```


- Is there any change over time?


```{r}
## figure of total number of characters male vs female

comics$decade <- trunc(comics$year/10)*10
comics$sex2 <- ifelse(comics$sex %in% c("Female","Male", NA), comics$sex, "Other") 

decades <- 
  comics %>%
  group_by(sex2,decade) %>%
  summarise(ave_app = mean(appearances,na.rm=T),
            total_app = sum(appearances,na.rm=T),
            char = length(appearances))

decades <- decades[!is.na(decades$sex2),]

ggplot(data=decades, aes(x=decade, y=char,fill=sex2))+
  geom_point(shape=21,size=3) + 
  geom_line(aes(colour=sex2))+
  labs(x="First apperance decade", y="Number of characters", fill="Gender", colour="Gender") + 
  mytheme + myfillscale + mycolorscale

ggplot(data=decades, aes(x=decade, y=ave_app,fill=sex2))+
  geom_point(shape=21,size=3) + 
  geom_line(aes(colour=sex2))+
  labs(x="First apperance decade", y="Average apperance by character", fill="Gender",colour="Gender") + 
  mytheme + myfillscale + mycolorscale

ggplot(data=decades, aes(x=decade, y=char,fill=sex2))+
  geom_bar(stat = "identity",position = "fill",colour="black") + 
  labs(x="First apperance decade", y="Proportion of total characters", fill="Gender",colour="Gender") + 
  mytheme + myfillscale + mycolorscale

```


- Does the company (DC vs. Marvel) have and effect?


```{r}
apperances2 <- dcast(data=apperances, publisher ~ sex, value.var = "total_app",fun.aggregate = sum)

apperances2[2:7]<- sapply( apperances2[2:7], function(x) return(ifelse(is.na(x),0,x)))

apperances2$tot <- apperances2$Female + apperances2$Male + apperances2$Agender + apperances2$Genderless + apperances2$Genderfluid + apperances2$Transgender
apperances2$percent_Female <- apperances2$Female/apperances2$tot
apperances2$percent_Male <- apperances2$Male/apperances2$tot
apperances2$percent_Other <- (apperances2$Agender + apperances2$Genderless + apperances2$Genderfluid + apperances2$Transgender)/apperances2$tot

apperances2[10:12]<- sapply(apperances2[10:12], function(x) return(round(x*100,1)))

knitr::kable(apperances2[c(1,10:12)],caption = "Percent of total number of apperances by gender")

```


- What can you say about "good characters" vs. "villains" in regards to their characteristics, gender, the company, over time?


```{r}

decades <- 
  comics %>%
  group_by(sex2,decade,publisher,align) %>%
  summarise(total_app = sum(appearances,na.rm=T))

decades2 <- dcast(data=decades[decades$align %in% c("Good","Bad","Neutral"),], publisher + align + decade ~ sex2, value.var = "total_app",fun.aggregate = sum)

decades2 <- decades2[!is.na(decades2$decade),]

ggplot(data=melt(decades2, id.vars = c("publisher","align","decade"), measure.vars = c("Female","Male","Other")),
       aes(x=as.factor(decade), y=value,fill=variable))+
  geom_bar(stat = "identity",position = "fill",colour="black") + 
  facet_grid(publisher~align) +
  labs(x="First apperance decade", y="Proportion of total apperances", fill="Gender",colour="Gender") + 
  mytheme + myfillscale + mycolorscale


```




## Prompt

![](images/DC_Versus_Marvel_1.jpg)

You are going to look into the raw data behind the story [Comic Books Are Still Made By Men, For Men And About Men](http://fivethirtyeight.com/features/women-in-comic-books/). 

The data come from [Marvel Wikia](http://marvel.wikia.com/Main_Page) and [DC Wikia](http://dc.wikia.com/wiki/Main_Page). Characters were scraped on August 24. Appearance counts were scraped on September 2. The month and year of the first issue each character appeared in was pulled on October 6.

The data are split into two files, for DC and Marvel, respectively: `dc-wikia-data.csv` and `marvel-wikia-data.csv` and are in the `data/` folder. A data dictionary is also in the `data` folder describing what each variable in the data mean.

In **teams of two**, explore this data with mostly plots to discover what is going on. Consider (but don't limit yourself to) the questions:

- Is there any pattern around gender in the characters of comics?
- Is there any change over time?
- Does the company (DC vs. Marvel) have and effect?
- What can you say about "good characters" vs. "villains" in regards to their characteristics, gender, the company, over time?

Your homework should be no more than 10 pages once knitted, and should be fully reproducible by the instructors. *Do not submit your .pdf files please.*

Your teams are assigned in the [README](README.md) file in this folder.

## Instructions:
Copy and save a **new copy** of this file, replacing "Lastname" and "Lastname" with the last names of the two people in your group, leaving the original unedited. 

In **your copy**, replace the `author:` field in the YAML above, while leaving the remaining fields intact. Remove the Prompt and Instructions sections and complete your homework!